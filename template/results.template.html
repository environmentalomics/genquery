<html>
<!--
#	HTML template for GenQuery running on EnvBase
#	Tim Booth Dec 2005 onwards.
#
#       If you are reading the HTML source rather than the original template
#       then be aware that these comments in the HTML will not make much sense
#       once the template has been munged through the code!
#
#	After public_catalogue.php		J.Wood 11/8/04
#       NERC Environmental Bioinformatics Centre
#       http://nebc.nox.ac.uk
-->
<head>
    <meta http-equiv="Content-Type" content="text/html" >
    <link rel="stylesheet" type="text/css" href="/genquery/gqstyle.css" />
    <link rel="stylesheet" type="text/css" href="/genquery/gqbuttons.css" />
    <style xmlns="" type="text/css">
    <!-- /* Put overrides in here! */
    -->
    </style>
    <TMPL_INCLUDE NAME="date_picker.tmpl">

    <title><TMPL_VAR NAME="SITE_TITLE"></title>
</head>
<body>
<div id="banner" align="center">

<!--Banner-->
<TMPL_VAR NAME="SITE_BANNER"><br />
<span class="description"></span>
</div></center>

<!--Show either the section title or a welcoming message-->
<TMPL_IF NAME="SHOWING_TOP_MENU">
    <h2>Welcome to GenQuery</h2>
<TMPL_ELSE>
    <h2><TMPL_VAR NAME="MENU_TITLE"></h2>
</TMPL_IF>

<hr />
<!--<h2>Tree menu mode</h2>-->
<!-- Also try out the tree-view mode at the same time - w00t -->
<form method="POST"  action='#query'>
<TMPL_VAR NAME="MENU_AND_CONNECTION_STATE">
<!--This pulls in all the required hidden fields -->
<!-- Logout button is essential where cookies are in use -->
<table class="htable">
<tr align="left" valign="top">
    <td><button type="submit" name="logout" value="Logout"
	    class="icon" id="logout" ><span class="buttontext">Logout</span></button>
    </td><td>
	<b> Log out of GenQuery </b>
    </td>
</tr>
<TMPL_LOOP NAME="PARENT_MENUS">
    <!-- Show the parent item -->
    <tr align="left" valign="top">
	<td colspan="2"><b> <TMPL_VAR NAME="MENU_ITEM_NAME"></b>
		       <!-- <TMPL_VAR NAME="MENU_ITEM_DATABASE"> -->
	</td>
	<td> <!--This will generate something like: 
		 <button type="submit" name="go_submenu_foo" value="Go" id="category_normal">Go</button>
	     --> 
	    <TMPL_VAR NAME="MENU_ITEM_SUBMIT"> 
	</td>
    </tr>
    <!-- Show all children in a nested loop -->
    <TMPL_LOOP NAME="CHILD_MENUS">
	<!--This pulls in all the required hidden fields -->
	<!-- TODO - indent properly, kill table if poss -->
	<tr align="left" valign="top">
	    <td colspan="3"><b> &nbsp;&nbsp;<TMPL_VAR NAME="MENU_ITEM_NAME"></b>
	    </td>
	    <td> <!--This will generate something like: 
		     <button type="submit" name="go_query_1" value="Go" id="query_1_normal">Go</button>
		 --> 
		<TMPL_VAR NAME="MENU_ITEM_SUBMIT"> 
	    </td>
	</tr>
    </TMPL_LOOP>
</TMPL_LOOP>

</table>
</form>

<!-- Now the actual input form -->
<!-- Note that for zero-input queries the CGI jumps straight to the results but if
     the query appears on the results page you can still see the prompt. -->

<TMPL_IF NAME="SHOWING_QUERY">
<a name="query"></a>
<TMPL_IF NAME="QUERY_PARAM_COUNT">
    <hr />

    <h2><TMPL_VAR NAME="QUERY_TITLE"></h2>

    <h3><TMPL_VAR NAME="QUERY_LABEL"></h3>

    <!-- Query form is generated by the Perl.  Is this acceptable? Perhaps not. -->
    <!-- old version
    <form method="POST" action='#results'>
	<table class="htable" />
	    <TMPL_VAR NAME="QUERY_FORM">
	    <tr><td colspan="2" style="text-align:right">
	    <input type="submit" name="submit" value="Run query"/>
	    </tr></td>
	</table>
    </form>
    -->

    <!-- New version -->
    <form method="POST" action='#results'>
	<table class="formtable" />
	    <TMPL_LOOP NAME="QUERY_PARAMS">
		<tr><td> 
		    <span class="gq_form_label">
		    <TMPL_VAR NAME="QUERY_PARAM_LABEL">
		    </span>
		</td><td>
		    <TMPL_VAR NAME="QUERY_PARAM_CONTROL">
		</td>
		</tr>
	    </TMPL_LOOP>
	    <tr><td colspan="2" style="text-align:right">
	    <TMPL_VAR NAME="QUERY_FORM_SUBMIT">
	    </tr></td>
	</table>
    </form>

</TMPL_IF>
</TMPL_IF>

<!-- Now the results -->
<a name="results"></a>
<TMPL_IF NAME="SHOWING_RESULTS">
    <hr />

    <h2><TMPL_VAR NAME="QUERY_TITLE"></h2>
    
    <table class="htable"> 
       <tr><td><b>Records returned: <TMPL_VAR NAME="ROWS_RETURNED"></b></td></tr>
       <tr><td><br></td></tr>
       <tr><td><br></td></tr>
    </table>

    <TMPL_IF NAME="LINKOUT_TARGET">
	<form method="POST" action='<TMPL_VAR NAME="LINKOUT_TARGET">'>
    </TMPL_IF>
    
    <!-- Set table styles by CSS references to htable -->
    <TMPL_IF NAME="ROWS_RETURNED">
	<table class="rtable" style="background-color:#EEEEEE">
	    <!-- <TH><font size=-1 color="#666666">Name</font></TH> -->
	    <tr align="left" valign="top"><TMPL_VAR NAME="RESULTS_TABLE_HEADER"></tr>
	   
	    <TMPL_LOOP name="RESULTS_TABLE_ROW">
		<tr align="left" valign="top"><TMPL_VAR NAME="ROW_DATA"></tr>
	    </TMPL_LOOP>
	</table>
    </TMPL_IF>

    
    <h3><p><a style="font-weight:bold" href='<TMPL_VAR NAME="PERMALINK">'>Permalink for this query</a></p>
    <!--
    <p><a style="font-weight:bold" href='<TMPL_VAR NAME="DOWNLOADLINK">'>Download as CSV</a> </br>
       <a style="font-weight:bold" href='<TMPL_VAR NAME="DOWNLOADLINK">;fmt=FASTA'>Download as FASTA</a>
        (this only makes sense for queries returning sequence data!)</p>
    </h3>
    -->

    <TMPL_IF NAME="LINKOUT_TARGET">
    <h3><TMPL_VAR NAME="LINKOUT_SUBMIT"></h3>
	</form>
    </TMPL_IF>

    <TMPL_IF NAME="DEBUGLINK">
	<!--Debugging mode for developers-->
	<h3><a href='<TMPL_VAR NAME="DEBUGLINK">'>Run this query in debug mode</a></h3>
    </TMPL_IF>

    <!-- The old linkout stuff, replaced by linkouts v2
    <TMPL_LOOP NAME="LINKOUTS">
	<h3><a href='<TMPL_VAR NAME=URL>'><TMPL_VAR NAME="LABEL"></a></h3>
    </TMPL_LOOP>
    -->

</TMPL_IF>

<TMPL_IF NAME="SHOWING_GRAPH">

    <img src='<TMPL_VAR NAME="GRAPH_LINK">;width=800;height=400' alt="graph"
	 width="800" height="400"/>

</TMPL_IF>

<h3>
<TMPL_LOOP NAME="EXPORT_FORMATS">

<a href='<TMPL_VAR NAME="EXPORT_LINK">'>Results as <TMPL_VAR NAME="EXPORT_LONG_NAME"></a>
<br>

</TMPL_LOOP>
</h3>

</html>
